# AirG- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†**: ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¹ãƒˆè¡¨ç¤ºã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ãƒ¬ãƒ¼ãƒ è¡¨ç¤º

- **ã‚¯ãƒ¬ãƒ¼ãƒ ç®¡ç†**: ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ã‚¯ãƒ¬ãƒ¼ãƒ ã®è¨­å®šãƒ»å‰Šé™¤
- **ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†**: ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ã®åˆ¶å¾¡ã€ã‚·ã‚¹ãƒ†ãƒ è¨­å®šç®¡ç†
- **ç’°å¢ƒå¯¾å¿œ**: æœ¬ç•ªç’°å¢ƒã¨ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ç’°å¢ƒã®ä¸¡æ–¹ã«å¯¾å¿œ
- **CLI**: çµ±ä¸€ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- **ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ API**: ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ç›´æ¥ä½¿ç”¨å¯èƒ½ Admin SDK

Firebase Admin SDK ã‚’ä½¿ç”¨ã—ã¦ AirGuard ã‚¢ãƒ—ãƒªã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚’è¡Œã†ãŸã‚ã® SDK ã§ã™ã€‚

## ğŸš€ æ©Ÿèƒ½

- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†**: ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒªã‚¹ãƒˆè¡¨ç¤ºã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ãƒ¬ãƒ¼ãƒ è¡¨ç¤º
- **ã‚¯ãƒ¬ãƒ¼ãƒ ç®¡ç†**: ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ã‚¯ãƒ¬ãƒ¼ãƒ ã®è¨­å®šãƒ»å‰Šé™¤
- **ç’°å¢ƒå¯¾å¿œ**: æœ¬ç•ªç’°å¢ƒã¨ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ç’°å¢ƒã®ä¸¡æ–¹ã«å¯¾å¿œ
- **CLI**: çµ±ä¸€ã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- **ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ API**: ä»–ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ç›´æ¥ä½¿ç”¨å¯èƒ½

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
src/
â”œâ”€â”€ index.js          # ãƒ¡ã‚¤ãƒ³ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ä½¿ç”¨ï¼‰
â”œâ”€â”€ cli.js            # CLIã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ firebaseAdmin.js  # Firebase Admin SDKè¨­å®š
â”œâ”€â”€ commands/         # æ©Ÿèƒ½ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
    â”œâ”€â”€ users.js      # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æ©Ÿèƒ½
    â”œâ”€â”€ claims.js     # ã‚¯ãƒ¬ãƒ¼ãƒ ç®¡ç†æ©Ÿèƒ½
    â””â”€â”€ system.js     # ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†æ©Ÿèƒ½
```

## ğŸ› ï¸ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ»ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# Firebase Admin SDK ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã‚’é…ç½®
# air-guard-v2-dev-firebase-adminsdk-fbsvc-f072726bf8.json
```

## ğŸ’» CLI ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰

```bash
# ãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤º
npm run cli -- --help

# ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã®ãƒ˜ãƒ«ãƒ—
npm run cli -- users --help
npm run cli -- claims --help
npm run cli -- system --help
```

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†

```bash
# ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
npm run cli -- users list

# ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¯ãƒ¬ãƒ¼ãƒ ã‚’è¡¨ç¤ºï¼ˆUIDæŒ‡å®šï¼‰
npm run cli -- users view <user-uid>
```

### ã‚¯ãƒ¬ãƒ¼ãƒ ç®¡ç†

```bash
# ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ãƒ¬ãƒ¼ãƒ ã‚’è¨­å®š
npm run cli -- claims set-superuser <uid-or-email>

# ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ãƒ¬ãƒ¼ãƒ ã‚’å‰Šé™¤
npm run cli -- claims remove-superuser <uid-or-email>

# ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ã‚¯ãƒ¬ãƒ¼ãƒ ã‚’è¨­å®šï¼ˆè¦ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰
npm run cli -- claims set-developer <uid-or-email>

# ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ã‚¯ãƒ¬ãƒ¼ãƒ ã‚’å‰Šé™¤
npm run cli -- claims remove-developer <uid-or-email>
```

### ç’°å¢ƒæŒ‡å®š

#### æ–¹æ³• 1: å°‚ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆæ¨å¥¨ï¼‰

```bash
# ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ç’°å¢ƒç”¨
npm run cli:emulator system status
npm run cli:emulator users list

# æœ¬ç•ªç’°å¢ƒç”¨
npm run cli:prod system status
npm run cli users list  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ¬ç•ªç’°å¢ƒ
```

#### æ–¹æ³• 2: ç›´æ¥å®Ÿè¡Œ

```bash
# æœ¬ç•ªç’°å¢ƒ
node src/cli.js system status

# ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ç’°å¢ƒ
node src/cli.js --env emulator system status

# ã‚«ã‚¹ã‚¿ãƒ ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ãƒ›ã‚¹ãƒˆ
node src/cli.js --env emulator --emulator-host localhost:9099 system status
```

#### æ–¹æ³• 3: npm run (å¾“æ¥æ–¹å¼)

```bash
# âš ï¸ æ³¨æ„: ã“ã®æ–¹å¼ã¯npm warningãŒå‡ºã¾ã™
npm run cli -- --env emulator users list
```

### ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†

#### æœ¬ç•ªç’°å¢ƒ

```bash
npm run cli system status
npm run cli system maintenance-on
npm run cli system maintenance-off
npm run cli system maintenance-toggle
npm run cli system init
```

#### ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ç’°å¢ƒ

```bash
npm run cli:emulator system status
npm run cli:emulator system maintenance-on
npm run cli:emulator system maintenance-off
```

#### ç›´æ¥å®Ÿè¡Œ

```bash
# æœ¬ç•ªç’°å¢ƒ
node src/cli.js system status

# ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ç’°å¢ƒ
node src/cli.js --env emulator system status
```

### ä½¿ç”¨ä¾‹

#### æ¨å¥¨: å°‚ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½¿ç”¨

```bash
# æœ¬ç•ªç’°å¢ƒã§ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒªã‚¹ãƒˆ
npm run cli users list

# ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ç’°å¢ƒã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ãƒ¬ãƒ¼ãƒ ã‚’ç¢ºèª
npm run cli:emulator users view abc123def456

# æœ¬ç•ªç’°å¢ƒã§ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ãƒ¬ãƒ¼ãƒ ã‚’è¨­å®š
npm run cli claims set-superuser user@example.com

# ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ç’°å¢ƒã§ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ã‚¯ãƒ¬ãƒ¼ãƒ ã‚’è¨­å®š
npm run cli:emulator claims set-developer abc123def456

# æœ¬ç•ªç’°å¢ƒã§ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–
npm run cli system maintenance-on

# ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ç’°å¢ƒã§ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹ã‚’ç¢ºèª
npm run cli:emulator system status
```

#### ç›´æ¥å®Ÿè¡Œ

```bash
# æœ¬ç•ªç’°å¢ƒ
node src/cli.js users list
node src/cli.js system maintenance-on

# ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ç’°å¢ƒ
node src/cli.js --env emulator users list
node src/cli.js --env emulator system status
```

````

## ğŸ”§ ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ä½¿ç”¨

### ã‚¯ãƒ©ã‚¹ä½¿ç”¨

```javascript
const { AirGuardAdminSDK } = require("./src/index.js");

// ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
const sdk = new AirGuardAdminSDK({
  env: "emulator",
  emulatorHost: "localhost:9099",
});

// ä½¿ç”¨ä¾‹
async function example() {
  try {
    // ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆã‚’å–å¾—
    await sdk.listSuperUsers();

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ãƒ¬ãƒ¼ãƒ ã‚’è¡¨ç¤º
    await sdk.viewUserClaims("user-uid");

    // ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ãƒ¬ãƒ¼ãƒ ã‚’è¨­å®š
    await sdk.setSuperUserClaim("user@example.com");

    // ç’°å¢ƒã‚’å¤‰æ›´
    sdk.setEnvironment("prod");
    await sdk.listSuperUsers();
  } catch (error) {
    console.error("Error:", error.message);
  }
}
````

### ç›´æ¥é–¢æ•°ä½¿ç”¨

```javascript
const { users, claims } = require("./src/index.js");

async function example() {
  const options = { env: "emulator" };

  try {
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
    await users.listSuperUsers(options);
    await users.viewUserClaims("user-uid", options);

    // ã‚¯ãƒ¬ãƒ¼ãƒ ç®¡ç†
    await claims.setSuperUserClaim("user@example.com", options);
    await claims.setDeveloperClaim("user-uid", { env: "prod" });
  } catch (error) {
    console.error("Error:", error.message);
  }
}
```

## ğŸ” ç’°å¢ƒè¨­å®š

### æœ¬ç•ªç’°å¢ƒ

- Firebase Admin SDK ãŒæœ¬ç•ªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æ¥ç¶š
- ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ãŒå¿…è¦

### ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ç’°å¢ƒ

- `FIREBASE_AUTH_EMULATOR_HOST` ç’°å¢ƒå¤‰æ•°ãŒè‡ªå‹•è¨­å®š
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `localhost:9099`

## ğŸ†š æ—§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‹ã‚‰ã®ç§»è¡Œ

### æ—§å½¢å¼ï¼ˆå»ƒæ­¢äºˆå®šï¼‰

```bash
npm run list:prod
npm run set:superuser:emulator
```

### æ–°å½¢å¼ï¼ˆæ¨å¥¨ï¼‰

```bash
npm run cli -- users list
npm run cli -- --env emulator claims set-superuser <uid>
```

## ğŸ“‹ åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰ä¸€è¦§

| ã‚«ãƒ†ã‚´ãƒª   | ã‚³ãƒãƒ³ãƒ‰                        | èª¬æ˜                     |
| ---------- | ------------------------------- | ------------------------ |
| **Users**  | `users list`                    | ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§è¡¨ç¤º |
|            | `users view <uid>`              | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¯ãƒ¬ãƒ¼ãƒ è¡¨ç¤º     |
| **Claims** | `claims set-superuser <uid>`    | ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š     |
|            | `claims remove-superuser <uid>` | ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤     |
|            | `claims set-developer <uid>`    | ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼è¨­å®š         |
|            | `claims remove-developer <uid>` | ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼å‰Šé™¤         |
| **System** | `system status`                 | ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹è¡¨ç¤º         |
|            | `system maintenance-on`         | ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æœ‰åŠ¹åŒ–       |
|            | `system maintenance-off`        | ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ç„¡åŠ¹åŒ–       |
|            | `system maintenance-toggle`     | ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹åˆ‡ã‚Šæ›¿ãˆ     |
|            | `system init`                   | ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–           |

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **Firebase æ¥ç¶šã‚¨ãƒ©ãƒ¼**

   ```bash
   # ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ã®ãƒ‘ã‚¹ã‚’ç¢ºèª
   # firebaseAdmin.jså†…ã®ãƒ‘ã‚¹è¨­å®šã‚’ç¢ºèª
   ```

2. **ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼æ¥ç¶šã‚¨ãƒ©ãƒ¼**

   ```bash
   # Firebaseã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
   firebase emulators:start --only auth
   ```

3. **æ¨©é™ã‚¨ãƒ©ãƒ¼**
   ```bash
   # ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«é©åˆ‡ãªæ¨©é™ãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
   # Firebase Authentication Adminæ¨©é™ãŒå¿…è¦
   ```

## ğŸ“ é–‹ç™º

### æ–°æ©Ÿèƒ½è¿½åŠ 

1. `src/commands/` ã«æ–°ã—ã„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¿½åŠ 
2. `src/cli.js` ã«ã‚³ãƒãƒ³ãƒ‰ã‚’ç™»éŒ²
3. `src/index.js` ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ API ã‚’è¿½åŠ 

### ãƒ†ã‚¹ãƒˆ

```bash
# CLIãƒ†ã‚¹ãƒˆ
npm run cli -- --help

# æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆï¼ˆã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼æ¨å¥¨ï¼‰
npm run cli -- --env emulator users list
```
